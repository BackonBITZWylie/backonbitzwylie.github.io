<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Tower Defense</title>
<style>
  body {
    margin: 0;
    background: #1a1a1a;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: Arial, sans-serif;
  }

  #game-container {
    position: relative;
  }

  canvas {
    background: #2c3e50;
    border: 4px solid #27ae60;
    border-radius: 8px;
  }

  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 18px;
  }

  #ui button {
    background: #27ae60;
    border: none;
    color: white;
    font-size: 15px;
    padding: 5px 10px;
    margin: 4px;
    border-radius: 4px;
    cursor: pointer;
    transition: 0.2s;
  }

  #ui button:hover {
    background: #2ecc71;
  }
</style>
</head>
<body>
<div id="game-container">
  <canvas id="gameCanvas" width="900" height="600"></canvas>
  <div id="ui">
    üí∞ Money: <span id="money">150</span> | ‚ù§Ô∏è Lives: <span id="lives">20</span> | üåä Wave: <span id="wave">1</span><br>
    <button data-tower="basic">Basic Tower (50)</button>
    <button data-tower="sniper">Sniper Tower (80)</button>
    <button data-tower="rapid">Rapid Tower (100)</button>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const moneyDisplay = document.getElementById("money");
const livesDisplay = document.getElementById("lives");
const waveDisplay = document.getElementById("wave");
const buttons = document.querySelectorAll("#ui button");

let money = 150, lives = 20, wave = 1;
let enemies = [], towers = [], bullets = [];
let placingTower = null;
let waveTimer = 0, waveCooldown = 400;

const lanes = [150, 250, 350, 450]; // multi-lane paths
const towerTypes = {
  basic: { cost: 50, range: 100, damage: 1, fireRate: 50, color: "#3498db" },
  sniper: { cost: 80, range: 200, damage: 3, fireRate: 100, color: "#9b59b6" },
  rapid: { cost: 100, range: 80, damage: 0.5, fireRate: 20, color: "#f1c40f" }
};

// Enemy Class
class Enemy {
  constructor(lane, waveLevel) {
    this.x = -20;
    this.y = lane;
    this.size = 20;
    this.hp = 3 + waveLevel;
    this.speed = 1 + waveLevel * 0.1;
  }
  update() { this.x += this.speed; }
  draw() {
    ctx.fillStyle = "red";
    ctx.fillRect(this.x, this.y - this.size/2, this.size, this.size);
    // HP bar
    ctx.fillStyle = "lime";
    ctx.fillRect(this.x, this.y - 15, (this.hp/ (3 + wave * 1.2)) * 20, 4);
  }
}

// Tower Class
class Tower {
  constructor(x, y, type) {
    Object.assign(this, towerTypes[type]);
    this.x = x;
    this.y = y;
    this.type = type;
    this.cooldown = 0;
    this.level = 1;
  }
  update() {
    if (this.cooldown > 0) this.cooldown--;
    const target = enemies.find(e => Math.hypot(e.x - this.x, e.y - this.y) < this.range);
    if (target && this.cooldown === 0) {
      bullets.push(new Bullet(this.x, this.y, target, this.damage));
      this.cooldown = this.fireRate;
    }
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, 15, 0, Math.PI*2);
    ctx.fillStyle = this.color;
    ctx.fill();
  }
}

// Bullet Class
class Bullet {
  constructor(x, y, target, damage) {
    this.x = x; this.y = y; this.target = target; this.damage = damage; this.speed = 5;
  }
  update() {
    if (!this.target) return;
    const dx = this.target.x - this.x, dy = this.target.y - this.y;
    const dist = Math.hypot(dx, dy);
    this.x += (dx/dist) * this.speed;
    this.y += (dy/dist) * this.speed;
    if (dist < 5) {
      this.target.hp -= this.damage;
      this.target = null;
    }
  }
  draw() {
    ctx.fillStyle = "yellow";
    ctx.beginPath();
    ctx.arc(this.x, this.y, 3, 0, Math.PI*2);
    ctx.fill();
  }
}

function spawnWave() {
  for (let i = 0; i < 6 + wave; i++) {
    setTimeout(() => {
      const lane = lanes[Math.floor(Math.random() * lanes.length)];
      enemies.push(new Enemy(lane, wave));
    }, i * 600);
  }
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw lanes
  ctx.strokeStyle = "#34495e";
  lanes.forEach(y => {
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.stroke();
  });

  // Enemies
  enemies.forEach((e, i) => {
    e.update(); e.draw();
    if (e.hp <= 0) {
      enemies.splice(i, 1);
      money += 10;
      moneyDisplay.textContent = money;
    } else if (e.x > canvas.width) {
      enemies.splice(i, 1);
      lives--;
      livesDisplay.textContent = lives;
      if (lives <= 0) { alert("Game Over!"); location.reload(); }
    }
  });

  // Towers
  towers.forEach(t => { t.update(); t.draw(); });

  // Bullets
  bullets.forEach((b, i) => {
    b.update(); b.draw();
    if (!b.target || b.x < 0 || b.x > canvas.width) bullets.splice(i, 1);
  });

  // Wave logic
  waveTimer++;
  if (waveTimer > waveCooldown && enemies.length === 0) {
    wave++;
    waveDisplay.textContent = wave;
    spawnWave();
    waveTimer = 0;
  }

  // Tower placement indicator
  if (placingTower) {
    ctx.beginPath();
    ctx.arc(mouse.x, mouse.y, towerTypes[placingTower].range, 0, Math.PI*2);
    ctx.strokeStyle = "rgba(255,255,255,0.3)";
    ctx.stroke();
  }

  requestAnimationFrame(gameLoop);
}

const mouse = { x: 0, y: 0 };
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
});

canvas.addEventListener("click", e => {
  if (placingTower && money >= towerTypes[placingTower].cost) {
    towers.push(new Tower(mouse.x, mouse.y, placingTower));
    money -= towerTypes[placingTower].cost;
    moneyDisplay.textContent = money;
    placingTower = null;
  } else {
    // upgrade tower on click
    towers.forEach(t => {
      if (Math.hypot(t.x - mouse.x, t.y - mouse.y) < 15) {
        if (money >= 50) {
          money -= 50;
          t.damage *= 1.3;
          t.range += 10;
          t.fireRate *= 0.9;
          t.level++;
          moneyDisplay.textContent = money;
        }
      }
    });
  }
});

buttons.forEach(btn => {
  btn.addEventListener("click", () => {
    placingTower = btn.dataset.tower;
  });
});

spawnWave();
gameLoop();
</script>
</body>
</html>
