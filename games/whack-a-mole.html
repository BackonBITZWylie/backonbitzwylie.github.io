<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Whack-a-Mole</title>
  <style>
    :root{
      --bg:#0f172a; /* dark navy */
      --card:#0b1220;
      --accent:#ffb703;
      --muted:#94a3b8;
      --hole:#021024;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    html,body{height:100%;margin:0}
    body{display:flex;align-items:center;justify-content:center;gap:24px;padding:28px;background:linear-gradient(180deg,var(--bg),#071227 60%);color:#e6eef8}

    .container{width:900px;max-width:95%;display:grid;grid-template-columns:1fr 360px;gap:22px;align-items:start}

    .game-card{background:linear-gradient(180deg,var(--card),#071226);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6);}

    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    header h1{font-size:20px;margin:0}
    header p{margin:0;color:var(--muted);font-size:13px}

    /* Grid of holes */
    .board{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:6px}
    .hole{
      background:radial-gradient(circle at 50% 40%, rgba(0,0,0,0.18), rgba(0,0,0,0.45)), linear-gradient(180deg,#051225,#021024);
      border-radius:14px;position:relative;overflow:hidden;height:120px;display:flex;align-items:flex-end;justify-content:center;cursor:pointer;user-select:none;transition:transform .08s ease;
      box-shadow: inset 0 -6px 20px rgba(0,0,0,0.6), 0 6px 12px rgba(2,8,20,0.6);
    }
    .hole:active{transform:scale(.98)}

    /* mound - the soil */
    .mound{position:absolute;left:0;right:0;bottom:0;height:34%;background:linear-gradient(180deg,#2b1206,#1a0b03);border-top-left-radius:200px;border-top-right-radius:200px;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.5)}

    /* mole (hidden by default) */
    .mole{
      --size:74px;
      width:var(--size);height:var(--size);position:relative;bottom:-4px;border-radius:50%;background:radial-gradient(circle at 35% 30%, #ffdd8b, #a85f32 60%);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 14px rgba(2,8,20,0.6);transform:translateY(100%);transition:transform .18s cubic-bezier(.2,.9,.3,1),filter .12s;
    }
    .mole.up{transform:translateY(-18%)}

    /* simple face */
    .mole::before{content:'';position:absolute;top:18%;left:50%;transform:translateX(-50%);width:44%;height:40%;border-radius:60% 60% 40% 40%;background:#3b210f}
    .eye{position:absolute;width:9px;height:9px;background:#041018;border-radius:50%;top:38%}
    .eye.left{left:36%}
    .eye.right{right:36%}
    .nose{position:absolute;width:8px;height:8px;background:#2a1106;border-radius:50%;top:50%}

    /* pop animation */
    .pop{animation:pop .36s ease}
    @keyframes pop{0%{transform:translateY(100%) scale(.9)}50%{transform:translateY(-6%) scale(1.05)}100%{transform:translateY(-18%) scale(1)}}

    /* control panel */
    .panel{display:flex;flex-direction:column;gap:12px;padding:12px}
    .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .stat{background:var(--glass);padding:10px;border-radius:10px;text-align:center}
    .stat strong{display:block;font-size:20px}
    .controls{display:flex;flex-direction:column;gap:8px}
    button{background:linear-gradient(180deg,var(--accent),#ff8a00);border:none;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer;color:#071227}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);font-weight:600}
    .difficulty{display:flex;gap:6px}
    .difficulty button{flex:1;background:transparent;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .difficulty button.active{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.08);color:var(--accent)}

    footer small{color:var(--muted)}

    /* responsive */
    @media (max-width:820px){
      .container{grid-template-columns:1fr;}
      .board .hole{height:100px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-card">
      <header>
        <div>
          <h1>Whack-a-Mole</h1>
          <p>Click the moles before they disappear â€” practice with timers & randomization!</p>
        </div>
        <div>
          <p style="text-align:right"><small>Made with love by BackonBITZ.</small></p>
        </div>
      </header>

      <div class="board" id="board" aria-live="polite">
        <!-- 9 holes -- generated by JS for clarity -->
      </div>

      <footer style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;font-size:13px">
        <small>Tip: try higher difficulty for faster moles.</small>
      </footer>
    </div>

    <aside class="game-card panel" aria-label="controls">
      <div class="stats">
        <div class="stat">
          <div style="font-size:12px;color:var(--muted)">Score</div>
          <strong id="score">0</strong>
        </div>
        <div class="stat">
          <div style="font-size:12px;color:var(--muted)">Time</div>
          <strong id="time">30</strong>
        </div>
      </div>

      <div class="controls">
        <button id="startBtn">Start Game</button>
        <div style="display:flex;gap:8px">
          <button class="secondary" id="resetBtn">Reset</button>
          <button class="secondary" id="pauseBtn">Pause</button>
        </div>

        <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
          <label for="duration">Game length (sec)</label>
          <input id="duration" type="number" min="5" max="120" value="30" style="width:72px;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px;border-radius:8px;color:inherit">
        </div>

        <div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Difficulty</div>
          <div class="difficulty">
            <button data-diff="easy" class="active">Easy</button>
            <button data-diff="medium">Medium</button>
            <button data-diff="hard">Hard</button>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
          <div>
            <div style="font-size:12px;color:var(--muted)">High Score</div>
            <strong id="highscore">0</strong>
          </div>
          <div style="text-align:right;font-size:12px;color:var(--muted)">Holes: 9</div>
        </div>
      </div>

      <div style="margin-top:6px;color:var(--muted);font-size:13px">Controls: Click or press the spacebar while the mole is focused to whack. Good luck!</div>
    </aside>
  </div>

  <script>
    // --- Game setup ---
    const BOARD = document.getElementById('board');
    const SCORE_EL = document.getElementById('score');
    const TIME_EL = document.getElementById('time');
    const START_BTN = document.getElementById('startBtn');
    const RESET_BTN = document.getElementById('resetBtn');
    const PAUSE_BTN = document.getElementById('pauseBtn');
    const DURATION_INPUT = document.getElementById('duration');
    const HIGH_EL = document.getElementById('highscore');

    const DIFFICULTY_BTNS = document.querySelectorAll('.difficulty button');

    const HOLE_COUNT = 9;
    let holes = [];

    let game = {
      score:0,
      time:parseInt(DURATION_INPUT.value,10) || 30,
      running:false,
      timerInterval:null,
      moleTimeouts:new Map(),
      lastHole:-1,
      highscore: Number(localStorage.getItem('wam_highscore') || 0),
      difficulty: 'easy',
    };

    HIGH_EL.textContent = game.highscore;
    TIME_EL.textContent = game.time;

    function createBoard(){
      for(let i=0;i<HOLE_COUNT;i++){
        const hole = document.createElement('div');
        hole.className = 'hole';
        hole.tabIndex = 0; // focusable for keyboard
        hole.dataset.index = i;

        const mound = document.createElement('div');
        mound.className = 'mound';

        const mole = document.createElement('div');
        mole.className = 'mole';
        mole.setAttribute('aria-hidden','true');

        const eyeL = document.createElement('div'); eyeL.className='eye left';
        const eyeR = document.createElement('div'); eyeR.className='eye right';
        const nose = document.createElement('div'); nose.className='nose';
        mole.appendChild(eyeL); mole.appendChild(eyeR); mole.appendChild(nose);

        hole.appendChild(mole);
        hole.appendChild(mound);

        // click handler
        hole.addEventListener('click',()=>whack(hole));
        hole.addEventListener('keydown',(e)=>{
          if(e.code === 'Space' || e.code === 'Enter'){
            e.preventDefault();
            whack(hole);
          }
        });

        BOARD.appendChild(hole);
        holes.push({hole,mole});
      }
    }

    createBoard();

    // --- Mole logic ---
    function randomTime(base){
      // base is median; add some randomness
      return Math.round((Math.random() * base) + (base * 0.5));
    }

    function pickHole(){
      const idx = Math.floor(Math.random()*HOLE_COUNT);
      if(idx === game.lastHole){
        // avoid same hole twice in a row
        return pickHole();
      }
      game.lastHole = idx;
      return holes[idx];
    }

    function popMole(){
      if(!game.running) return;

      const {mole,hole} = pickHole();
      const upTime = moleUpTimeForDifficulty();

      mole.classList.add('up','pop');
      mole.setAttribute('aria-hidden','false');

      // remove pop class after animation
      setTimeout(()=>mole.classList.remove('pop'),360);

      // set a timeout to hide
      const hideId = setTimeout(()=>{
        mole.classList.remove('up');
        mole.setAttribute('aria-hidden','true');
        game.moleTimeouts.delete(hideId);
        // schedule another pop
        if(game.running) scheduleNextPop();
      }, upTime);

      game.moleTimeouts.set(hideId, {mole,hideId});
    }

    function scheduleNextPop(){
      if(!game.running) return;
      const delay = nextSpawnDelayForDifficulty();
      setTimeout(()=>{
        if(game.running) popMole();
      }, delay);
    }

    function moleUpTimeForDifficulty(){
      switch(game.difficulty){
        case 'hard': return randomTime(650); // ~650-1300
        case 'medium': return randomTime(900);
        default: return randomTime(1200);
      }
    }
    function nextSpawnDelayForDifficulty(){
      switch(game.difficulty){
        case 'hard': return 300 + Math.random()*350; // faster spawns
        case 'medium': return 400 + Math.random()*550;
        default: return 600 + Math.random()*800;
      }
    }

    // --- Whacking ---
    function whack(holeEl){
      if(!game.running) return;
      const mole = holeEl.querySelector('.mole');
      if(!mole.classList.contains('up')){
        // optional: penalty for wrong whack (not applied here)
        return;
      }

      // increase score and give visual feedback
      game.score += 1;
      SCORE_EL.textContent = game.score;

      // mole reacts
      mole.classList.remove('up');
      mole.setAttribute('aria-hidden','true');
      // small feedback pop
      mole.style.filter = 'brightness(1.12) saturate(1.05)';
      setTimeout(()=>{ mole.style.filter = ''; },120);

      // play a small sound via web audio for fun (no external files)
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine'; o.frequency.value = 720 + Math.random()*220;
        g.gain.value = 0.02;
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.06);
      }catch(e){ /* ignore if blocked */ }

      // keep track of high score
      if(game.score > game.highscore){
        game.highscore = game.score; HIGH_EL.textContent = game.highscore; localStorage.setItem('wam_highscore', String(game.highscore));
      }
    }

    // --- Timer and controls ---
    function startGame(){
      if(game.running) return;
      game.score = 0; SCORE_EL.textContent = 0;
      game.time = Math.max(5, Math.min(120, parseInt(DURATION_INPUT.value,10) || 30));
      TIME_EL.textContent = game.time;
      game.running = true;

      START_BTN.textContent = 'Playing...'; START_BTN.disabled = true;
      PAUSE_BTN.textContent = 'Pause';

      // initial mole waves
      for(let i=0;i<2;i++) scheduleNextPop();

      // main countdown
      game.timerInterval = setInterval(()=>{
        game.time -= 1; TIME_EL.textContent = game.time;
        if(game.time <= 0){ endGame(); }
      }, 1000);
    }

    function pauseGame(){
      if(!game.running) return;
      game.running = false;
      START_BTN.disabled = false; START_BTN.textContent = 'Start Game';
      PAUSE_BTN.textContent = 'Resume';
      clearInterval(game.timerInterval);
      // clear scheduled mole hide timeouts (but not the setTimeouts used to schedule next pops)
      for(const [id,_] of game.moleTimeouts){ clearTimeout(id); }
      game.moleTimeouts.clear();
    }

    function resumeGame(){
      if(game.running) return;
      game.running = true; START_BTN.disabled = true; START_BTN.textContent = 'Playing...'; PAUSE_BTN.textContent = 'Pause';
      // resume countdown
      game.timerInterval = setInterval(()=>{
        game.time -= 1; TIME_EL.textContent = game.time;
        if(game.time <= 0) endGame();
      },1000);
      // schedule a couple of pops to restart action
      for(let i=0;i<2;i++) scheduleNextPop();
    }

    function endGame(){
      game.running = false;
      START_BTN.disabled = false; START_BTN.textContent = 'Start Game';
      PAUSE_BTN.textContent = 'Pause';
      clearInterval(game.timerInterval);
      // hide any visible moles and clear stored timeouts
      for(const {mole} of holes){ mole.classList.remove('up','pop'); mole.setAttribute('aria-hidden','true'); }
      for(const [id,_] of game.moleTimeouts){ clearTimeout(id); }
      game.moleTimeouts.clear();
      // final highscore save
      if(game.score > game.highscore){ game.highscore = game.score; localStorage.setItem('wam_highscore', String(game.highscore)); HIGH_EL.textContent = game.highscore; }
      // small celebration â€” a quick blink of the score
      SCORE_EL.animate([{transform:'scale(1)'},{transform:'scale(1.18)'},{transform:'scale(1)'}],{duration:400,easing:'ease'});
    }

    START_BTN.addEventListener('click', startGame);
    RESET_BTN.addEventListener('click', ()=>{
      pauseGame(); game.score = 0; SCORE_EL.textContent='0'; game.time = parseInt(DURATION_INPUT.value,10)||30; TIME_EL.textContent = game.time;
      for(const {mole} of holes){ mole.classList.remove('up','pop'); mole.setAttribute('aria-hidden','true'); }
    });
    PAUSE_BTN.addEventListener('click', ()=>{
      if(game.running) pauseGame(); else resumeGame();
    });

    // difficulty buttons
    DIFFICULTY_BTNS.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        DIFFICULTY_BTNS.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        game.difficulty = btn.dataset.diff;
      });
    });

    // helpful keyboard: spacebar whack focused hole
    document.addEventListener('keydown',(e)=>{
      if(e.code === 'Space'){
        // if focus is on a hole, whack it
        const el = document.activeElement;
        if(el && el.classList && el.classList.contains('hole')){
          e.preventDefault(); whack(el);
        }
      }
    });

    // set initial seed of holes with small random pre-pop
    (function warmup(){
      for(let i=0;i<3;i++){ setTimeout(()=>{ if(!game.running) return; scheduleNextPop(); }, i*200); }
    })();

    // expose a little debug API on window if needed
    window._wam = {game,holes};
  </script>
</body>
</html>
